# 绘制正方体

## WebGL 坐标系

3D 形体的顶点坐标系需要包含深度信息 z 轴坐标。所以我们先了解一下 WebGL 坐标系的概念。

WebGL 采用了左手坐标系，x 轴向右为正，y 轴向上为正，z 轴沿着屏幕往里为正。

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/9/29/16624dfadfcfef91~tplv-t2oaga2asx-watermark.awebp)

WebGL 是遵循右手坐标系，但仅仅是遵循，是期望大家遵守的规范。其实 WebGL 内部（裁剪坐标系）是基于左手坐标系的，z 轴沿屏幕向里为正方向。

WebGL 坐标系 X、Y、Z 三个坐标分量的的范围是 [-1，1]，即一个边长为 2 的正方体，原点在正方体中心。这点在之前的章节有介绍，我们也称这个坐标系为**标准设备坐标系**，简称 **NDC 坐标系**。

前面我们经常在顶点着色器中使用内置属性 `gl_Position`，并且在为 `gl_Position` 赋值之前做了一些坐标系转换（屏幕坐标系转换到裁剪坐标系）操作。

> 为了理解 gl_Position 接收坐标前所做的变换目的，这就需要理解 `gl_Position` 接收什么样的坐标。

`gl_Position` 接收一个 4 维浮点向量，该向量代表的是**裁剪坐标系**的坐标。

`gl_Position` 接收的坐标范围是顶点在裁剪坐标系中的坐标。

裁剪坐标系中的坐标通常由四个分量表示：(x, y, z, w)。请注意，w 分量代表**齐次坐标分量**，在之前的例子中，w 都是设置成 1 ，这样做的目的是让裁剪坐标系和 NDC 坐标系就保持一致，省去裁剪坐标到 NDC 坐标的转换过程。

`gl_Position` 接收到裁剪坐标之后，顶点着色器会对坐标进行透视除法，透视除法的公式是 (x/w, y/w, z/w, w/w) ，透视除法过后，顶点在裁剪坐标系中的坐标就会变成 NDC 坐标系中的坐标，各个坐标的取值范围将被限制在 [-1，1] 之间，如果某个坐标超出这个范围，将会被 GPU 丢弃。

> 透视除法这个步骤是顶点着色器程序黑盒执行的，对开发者来说是透明的，无法通过编程手段干预。但是我们需要明白有这么一个过程存在。

在前面的例子中，我们给出的顶点坐标都是基于**屏幕坐标系**，然后在顶点着色器中对顶点作简单转换处理，转变成 NDC 坐标。

```js
const VERTEX_SHADER_SOURCE = `
  precision mediump float;
  attribute vec2 a_Position;
  attribute vec2 a_Screen_Size;
  void main() {
    vec2 position = (a_Position / a_Screen_Size) * 2.0 - 1.0;
    position = position * vec2(1.0, -1.0);
    gl_Position = vec4(position, 0, 1);
  }
`
```

本节我们不着重讲解坐标系变换，而是为了讲解物体如何由三角形组成，所以会忽略裁剪坐标系之前的一些坐标变换，在 JavaScript 中直接采用**裁剪坐标系坐标**来表示顶点位置。

## 用三角形构建正方体

一个只包含坐标信息的立方体实际上是由 6 个正方形，每个正方形由两个三角形组成，每个三角形由三个顶点组成，所以一个立方体由 6 个正方形 * 2 个三角形 * 3 个顶点 = 36 个顶点组成，但是这 36个顶点中有很多是重复的，我们很容易发现：一个纯色立方体实际上由 6 个矩形面，或者 8 个不重复的顶点组成。

**注意：**顶点的重复与否，不只取决于顶点的坐标信息一致，还取决于该顶点所包含的其他信息是否一致。比如顶点纹理坐标 uv、顶点法线，顶点颜色等。**一旦有一个信息不同，就必须用两个顶点来表示。**

仍然以矩形举例，每个顶点只包含**坐标**和**颜色**两类信息。如果我们的矩形是纯色的，假设是红色。

```js
// 顶点信息
const positions = [
  30, 30, 1, 0, 0, 1, // v0
  30, 370, 1, 0, 0, 1, // v1
  370, 370, 1, 0, 0, 1, // v2
  30, 30, 1, 0, 0, 1, // v0,
  370, 370, 1, 0, 0, 1, // v2
  370, 30, 1, 0, 0, 1, // v3
]
```